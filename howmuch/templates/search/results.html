{% extends "3columns.html" %}

{% load search_tags %}

{% block media_js %}
<script type="text/javascript">
$(document).on('ready', function(){
	if("{{ searchresults.query }}"!="all:1"){
		if(document.URL.split("/search/")[1].split("{{ searchresults.query }}".split(":")[1].split("*")[0])[1]=="/"){
			$('#query_nav_delete').show();
		}
		$('#query_nav').text("\""+"{{ searchresults.query }}".split(":")[1].split("*")[0]+"\"");
		$('#query_nav_link').attr("href","/search/"+"{{ searchresults.query }}".split(":")[1].split("*")[0]);
	}
	filters="{{ filters }}".split(",");
	for(i=0; i<filters.length; i++){
		items=filters[i].split(":");
		aux=items[0].split("&#39;")[1];
		if(aux=="category"){
			$('#category_nav_ind').show();
			if("{{ searchresults.query }}"!="all:1" || (document.URL.split("/search/")[1].split("_category_")[1].indexOf("_")==-1 && document.URL.split("/search/")[1].split("_category_")[0]=="")){
				$('#category_nav_delete').show();
			}
			$('#category_nav').text($('#_category_'+items[1].split("&#39;")[1]).text().split("(")[0]);
			if("{{ searchresults.query }}"!="all:1"){
				$('#category_nav_link').attr("href",$('#query_nav_link').attr("href")+"_category_"+items[1].split("&#39;")[1]);
			}
			else{
				$('#category_nav_link').attr("href","/search/"+"_category_"+items[1].split("&#39;")[1]);
			}
		}
		else if(aux=="rangePrice"){
			$('#rangePrice_nav_ind').show();
			$('#rangePrice_nav_delete').show();
			if(items[1].split("&#39;")[1]=="0to500" || items[1].split("&#39;")[1]=="500to1000" || items[1].split("&#39;")[1]=="1000to5000" || items[1].split("&#39;")[1]=="gte5000"){
				$('#rangePrice_nav').text($('#_rangePrice_'+items[1].split("&#39;")[1]).text().split("(")[0]);
			}
			else{
				if(items[1].split("&#39;")[1].split("to")[0]==""){
					$('#rangePrice_nav').text("Hasta $"+items[1].split("&#39;")[1].split("to")[1]);
				}
				else if(items[1].split("&#39;")[1].split("to")[1]==""){
					$('#rangePrice_nav').text("Más de $"+items[1].split("&#39;")[1].split("to")[0]);
				}
				else{
					$('#rangePrice_nav').text("$"+items[1].split("&#39;")[1].split("to")[0]+" a $"+items[1].split("&#39;")[1].split("to")[1]);
				}
			}
		}
		else if(aux=="state"){
			$('#state_nav_ind').show();
			$('#state_nav_delete').show();
			$('#state_nav').text($('#_state_'+items[1].split("&#39;")[1]).text().split("(")[0]);
			if("{{ searchresults.query }}"!="all:1"){
				$('#state_nav_link').attr("href",$('#query_nav_link').attr("href")+"_state_"+items[1].split("&#39;")[1]);
			}
			else{
				$('#state_nav_link').attr("href","/search/"+"_state_"+items[1].split("&#39;")[1]);
			}
		}
	}

	$('.delete_query').click(function(e){
		if(document.URL.split("/search/")[1].indexOf("_")!=-1){
			window.location.assign(document.URL.split("/search/")[0]+"/search/"+document.URL.split("/search/")[1].substr(document.URL.split("/search/")[1].indexOf("_")));
		}
		else{
			window.location.assign("/");
		}
	});

	$('.delete_category').click(function(e){
		if(document.URL.split("/search/")[1].split("_category_")[0]!=""){
			if(document.URL.split("/search/")[1].split("_category_")[1].indexOf("_")!=-1){
				window.location.assign(document.URL.split("/search/")[0]+"/search/"+document.URL.split("/search/")[1].split("_category_")[0]+document.URL.split("/search/")[1].split("_category_")[1].substr(document.URL.split("/search/")[1].split("_category_")[1].indexOf("_")));
			}
			else{
				window.location.assign(document.URL.split("/search/")[0]+"/search/"+document.URL.split("/search/")[1].split("_category_")[0]);
			}
		}
		else{
			window.location.assign("/");
		}
	});

	$('.delete_rangePrice').click(function(e){
		if(document.URL.split("/search/")[1].split("_rangePrice_")[1].indexOf("_")!=-1){
			window.location.assign(document.URL.split("/search/")[0]+"/search/"+document.URL.split("/search/")[1].split("_rangePrice_")[0]+document.URL.split("/search/")[1].split("_rangePrice_")[1].substr(document.URL.split("/search/")[1].split("_rangePrice_")[1].indexOf("_")));
		}
		else{
			window.location.assign(document.URL.split("/search/")[0]+"/search/"+document.URL.split("/search/")[1].split("_rangePrice_")[0]);
		}
	});

	$('.delete_state').click(function(e){
		if(document.URL.split("/search/")[1].split("_state_")[0]!=""){
			if(document.URL.split("/search/")[1].split("_state_")[1].indexOf("_")!=-1){
				window.location.assign(document.URL.split("/search/")[0]+"/search/"+document.URL.split("/search/")[1].split("_state_")[0]+document.URL.split("/search/")[1].split("_state_")[1].substr(document.URL.split("/search/")[1].split("_state_")[1].indexOf("_")));
			}
			else{
				window.location.assign(document.URL.split("/search/")[0]+"/search/"+document.URL.split("/search/")[1].split("_state_")[0]);
			}
		}
		else{
			window.location.assign("/");
		}
	});
});
</script>
{% endblock %}

{% block section1 %}
	{% include "categories2.html" %}
{% endblock %}

{% block section2 %}
	<div class="content">
		<div class="head">
			<div class="info margin-bottom-1em">
				<h1 class="font-size-1_5em">Búsqueda</h1>
				{% if article %}
				<div class="description">
					Has buscado
					<span class="attention">&laquo;</span>
					<span class="query strong">{{ article }}</span>
					<span class="attention">&raquo;</span>.
				</div>
				{% endif %}
			</div>
		</div>
		<div class="items border">
			<!-- Top items options starts -->
			<div class="path padding-0_5em">
				<a id="query_nav_link" href="">
					<span id="query_nav"></span>
				</a>
				<a id="query_nav_delete" class="delete_query" href="#" style="display:none"><button>x</button></a>
				<span id="category_nav_ind" class="attention" style="display:none">&raquo;</span>
				<a id="category_nav_link" href="">
					<span id="category_nav"></span>
				</a>
				<a id="category_nav_delete" class="delete_category" href="#" style="display:none"><button>x</button></a>
				<span id="state_nav_ind" class="attention" style="display:none">&raquo;</span>
				<a id="state_nav_link" href="">
					<span id="state_nav"></span>
				</a>
				<a id="state_nav_delete" class="delete_state" href="#" style="display:none"><button>x</button></a>
				<span id="rangePrice_nav_ind" class="attention" style="display:none">&raquo;</span>
				<a id="rangePrice_nav_link" href="">
					<span id="rangePrice_nav"></span>
				</a>
				<a id="rangePrice_nav_delete" class="delete_rangePrice" href="#" style="display:none"><button>x</button></a>
			</div>

			<div class="arrange group padding-0_5em">
				<div class="float-left width-75">
					Se muestran <strong>{{ searchresults.matches }}</strong> de <strong>{{ searchresults.matches }}</strong> resultados
				</div>
				<div class="float-right width-25">
					<select class="width-100 font-size-0_8em">
						<option>Precio bajo a alto</option>
						<option>Precio alto a bajo</option>
						<option>Orden alfabético</option>
					</select>
				</div>
			</div>
			<!-- Top items options ends -->
			
			
			<!-- Now, items list starts -->
			<div class="items-list">
				<!-- 3 ITEMS GROUP STARTS -->
				<div class="items-group group margin-bottom-1em border-bottom-dashed">
					{% for result in searchresults.results %}
					<!-- Item starts -->
					<div class="item float-left width-33_3 margin-top-1em margin-bottom-1em text-align-justify">
						<div class="item-image-container padding-0_5em">
							<a href="#">
								<img class="item-image width-100" src="{{ result.img }}" alt="{{ result.text|title }}" />
							</a>
						</div>
						<div class="item-header padding-0_5em">
							<a href="#">{{ result.text|title }}</a>
						</div>
						<div class="item-price padding-0_5em">$ {{ result.price }}</div>
						<div class="item-extra padding-0_5em font-size-0_8em">
							<span class="attention">&laquo;</span>
							<span class="item-extra-info">
								{{ result.description }}
							</span>
							<span class="attention">&raquo;</span>
						</div>
						<div class="tags">
							{{ result.tags|tagsformat }}
						</div>
					</div>
					<!-- Item ends -->
					{% empty %}
					<!-- NOT FOUND -->
					<div class="notification borders margin-top-1em margin-bottom-1em">
						No se encontraron resultados.
					</div>
					{% endfor %}								
				</div>
				<!-- 3 ITEMS GROUP ENDS -->						
			</div>
			<!-- Now, items list ends -->
		</div>
	</div>
<!-- Old
<h3 id="aver"><a href="/">Inicio</a><abbr id="query_nav_ind" style="display:none"> > </abbr><a id="query_nav" href=""></a><a id="query_nav_delete" class="btn btn-mini delete_query" href="#" style="display:none"><i class="icon-remove"></i></a><abbr id="category_nav_ind" style="display:none"> > </abbr><a id="category_nav" href=""></a><a id="category_nav_delete" class="btn btn-mini delete_category" href="#" style="display:none"><i class="icon-remove"></i></a><abbr id="state_nav_ind" style="display:none"> > </abbr><a id="state_nav" href=""></a><a id="state_nav_delete" class="btn btn-mini delete_state" href="#" style="display:none"><i class="icon-remove"></i></a><abbr id="rangePrice_nav_ind" style="display:none"> > </abbr><a id="rangePrice_nav" href=""></a><a id="rangePrice_nav_delete" class="btn btn-mini delete_rangePrice" href="#" style="display:none"><i class="icon-remove"></i></a></h3>
<section class="wrapper-div">
	<div class="text-center">
		{% if not filtros %}
		<h3>{{ searchresults.matches }} personas estan comprando una <em>{{ article }}</em></h3>
		{% endif %}
	</div>
	{% for result in searchresults.results %}
	<article class="wrapper-div5 hover1">
		<div class="row-fluid">
			<div class="thumbnail span3">
				<a href="{{ result.docid }}">
					<img src="{{ result.img }}">
				</a>
			</div>
			<div class="span6">
				<div class="margin10">	
					<a class="a-title-large" href="{{ result.docid }}">{{ result.text|title }}</a>
				</div>
				<div class="margin10">
					<p>
					{{ result.description }}
					</p>
				</div>
				<div class="text-center">
					{{ result.tags|tagsformat }}
				</div>
			</div>
			<div class="span3 text-center">
				<div class="wrapper-div4">
					<h2>$ {{ result.price }}</h2>
				</div>
				<div class="wrapper-div2">
					<h4>{{ result.state }}</h4>
				</div>
			</div>
		</div>
	</article>
	{% endfor %}
</section> Old -->
{% endblock %}

{% block section3 %}
	{% include "howtodo.html" %}
{% endblock %}